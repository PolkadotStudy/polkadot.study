# Implementation

In the chapter of the tutorial you will create a fully working smart contract. Let's start with creation your first ink! smart contract:

```bash
cargo new automated_market_maker
```

ink! smart contract programming language is based on Rust and that is why the most important file
where we will implement a whole business logic is `lib.rs`. Helicopter view of the file `lib.rs` looks like below:

```rust
#![cfg_attr(not(feature = "std"), no_std)]

const PRECISION: u128 = 1_000_000;

#[ink::contract]
pub mod automated_market_maker {

    use ink_prelude::collections::BTreeMap;

    /// Section: Definition of a storage

    #[ink(impl)]
    impl AutomatedMarketMaker {

        /// Section: Constructor


        /// Section: Business logic and core functions like:
        /// -   Providing new liquidity to the pool
        /// -   Swap
        /// -   Removing liquidity from a pool
        /// -   Liquidity constant curve of a pool

    }

        /// Section: Utils, errors definitions

    }
}
```

## Definition of a storage

```rust
    /// Storage
    #[ink(storage)]
    #[derive(Default)]
    pub struct AutomatedMarketMaker {
        trading_fee: Balance, // Percent of trading fees charged on every trade
        token1_balance: BTreeMap<AccountId, Balance>, // Amount of token1 balance of each user
        token2_balance: BTreeMap<AccountId, Balance>, // Amount of token2 balance of each user
        pool_total_token1: Balance, // The amount of token1 locked in the pool
        pool_total_token2: Balance, // The amount of token2 locked in the pool
        total_shares: Balance, // Stores the total amount of share issued for the pool
        shares: BTreeMap<AccountId, Balance>, // Stores the share holding of each user
    }
```

## Constructor

Constructor is the hear of every smart contract.

```rust
/// Instantiating AMM instance
/// @param _fees: valid interval -> [0,1000)
#[ink(constructor)]
pub fn new(_fees: Balance) -> Self {
    Self {
        trading_fee: if _fees >= 1000 { 0 } else { _fees },
        ..Default::default()
    }
}
```

## Business logic and core functions

## Utils, errors definitions

## Additional information

More information regarding ink! smart contracts programming language you will find in the [documentation](https://use.ink).

It's important to note that DEX development involves complex engineering challenges and requires a deep understanding of blockchain technology, cryptography, and security practices.
Collaboration with blockchain experts and continuous learning about evolving protocols and standards is essential in building a successful decentralized exchange.

While smart contracts are designed to be immutable, there are situations where it becomes necessary to make changes or upgrades to them. Developers may encounter scenarios where they need to address critical bugs or introduce additional features.

In order to build the whole smart contract use following commands:
```bash
git clone git@github.com:TomaszWaszczyk/ink-automated-market-maker.git
cd ink-automated-market-maker/automated-market-maker
cargo +nightly build --release
```

The project uses also `cargo fmt` tool in order to deliver well formatted source code, details how to use the tool you can find in the [link.](https://github.com/rust-lang/rustfmt)

If you are interested in more learning and development of the smart contract one of the option is to implement `proxy pattern`. That is an example of improvement proposal that actually adds real value.

## Github repository

I encourage you to explore the entire source of [the decentralized exchange source](https://github.com/TomaszWaszczyk/ink-automated-market-maker) code and unleash your creativity to enhance it. There is no better approach to learning than by actively engaging with the code, conducting experiments, and making improvements in a live environment.
